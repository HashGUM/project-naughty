#!/usr/bin/env python
import os
import sys

# 获取godot-cpp路径
godot_cpp_path = "godot-cpp/"
cpp_bindings = godot_cpp_path + "gdextension/"

env = SConscript(godot_cpp_path + "SConstruct")

# 添加llama.cpp头文件路径
env.Append(CPPPATH=["src/", "include/"])

# 添加llama.cpp库链接
if env["platform"] == "windows":
    env.Append(LIBPATH=["bin/"])
    # 链接llama.cpp相关库
    env.Append(LIBS=["llama", "ggml", "ggml-base", "ggml-cpu"])
    
# 添加源文件
sources = [
    "src/llama_inference.cpp",
    "src/register_types.cpp",
]

# 输出文件名
if env["platform"] == "windows":
    library_name = "bin/libllama_godot.{}.{}.{}{}".format(
        env["platform"], 
        env["target"], 
        env["arch"],
        env["SHLIBSUFFIX"]
    )
elif env["platform"] == "linux":
    library_name = "bin/libllama_godot.{}.{}.{}{}".format(
        env["platform"],
        env["target"],
        env["arch"],
        env["SHLIBSUFFIX"]
    )
else:
    library_name = "bin/libllama_godot.{}.{}.{}{}".format(
        env["platform"],
        env["target"],
        env["arch"],
        env["SHLIBSUFFIX"]
    )

# 构建共享库
library = env.SharedLibrary(library_name, source=sources)

Default(library)

